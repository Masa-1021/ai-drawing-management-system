# タスクリスト - AI駆動型CAD図面管理システム

## 概要

- **総タスク数**: 45タスク
- **推定作業時間**: 2-3週間（2名体制想定）
- **優先度**: 高

## タスク一覧

### Phase 0: 環境セットアップ（推定: 2-4時間）

#### Task 0.1: プロジェクト構造の作成

- [ ] プロジェクトルートディレクトリ作成
- [ ] バックエンド用ディレクトリ構造作成（`backend/app/`, `backend/prompts/`, `backend/tests/`）
- [ ] フロントエンド用ディレクトリ構造作成（`frontend/src/`）
- [ ] ストレージディレクトリ作成（`storage/drawings/`, `storage/thumbnails/`, `storage/logs/`）
- [ ] 設定ファイルのテンプレート作成（`config.json`, `.env.example`）
- **完了条件**: 全ディレクトリが作成され、`.gitignore`が設定されている
- **依存**: なし
- **推定時間**: 30分

#### Task 0.2: バックエンド依存関係のセットアップ

- [ ] `pyproject.toml` 作成（Poetry）
- [ ] 必要なパッケージ追加（FastAPI, SQLAlchemy, boto3, PyMuPDF, Pillow, tenacity, etc.）
- [ ] `poetry install` 実行
- [ ] Python環境の動作確認
- **完了条件**: `poetry install`が成功し、Pythonが起動する
- **依存**: Task 0.1
- **推定時間**: 30分

#### Task 0.3: フロントエンド依存関係のセットアップ

- [ ] `package.json` 作成（Vite + React + TypeScript）
- [ ] 必要なパッケージ追加（React, React Router, Zustand, Tailwind, shadcn/ui, PDF.js, Axios, etc.）
- [ ] `npm install` 実行
- [ ] Tailwind CSS設定
- [ ] Vite設定（プロキシ設定含む）
- **完了条件**: `npm run dev`が成功し、ブラウザでアプリが表示される
- **依存**: Task 0.1
- **推定時間**: 1時間

#### Task 0.4: 環境変数と設定ファイルの準備

- [ ] `.env.example` 作成（AWS認証情報のテンプレート）
- [ ] `config.json` のサンプル作成
- [ ] README.md 作成（セットアップ手順記載）
- **完了条件**: 環境変数が正しく読み込まれる
- **依存**: Task 0.1
- **推定時間**: 30分

---

### Phase 1: バックエンド基礎実装（推定: 2-3日）

#### Task 1.1: データベースモデルの実装

- [ ] SQLAlchemy Base設定
- [ ] `Drawing` モデル実装
- [ ] `ExtractedField` モデル実装
- [ ] `Balloon` モデル実装
- [ ] `Revision` モデル実装
- [ ] `Tag` モデル実装
- [ ] `EditHistory` モデル実装
- [ ] `Lock` モデル実装
- [ ] リレーションシップ設定
- [ ] インデックス設定
- **完了条件**: 全モデルが定義され、マイグレーションが実行できる
- **依存**: Task 0.2
- **推定時間**: 3時間

#### Task 1.2: データベース初期化スクリプト

- [ ] `init_db.py` 作成
- [ ] テーブル作成ロジック実装
- [ ] 初期データ投入機能（オプション）
- [ ] DBファイル生成確認
- **完了条件**: `python init_db.py`でDBが作成される
- **依存**: Task 1.1
- **推定時間**: 1時間

#### Task 1.3: 設定管理（ConfigManager）の実装

- [ ] `ConfigManager` クラス実装
- [ ] `config.json` 読み込み機能
- [ ] `.env` 読み込み機能（pydantic-settings）
- [ ] 設定値のバリデーション
- [ ] 設定値取得メソッド実装
- **完了条件**: 設定ファイルから値を取得できる
- **依存**: Task 0.2
- **推定時間**: 2時間

#### Task 1.4: PromptManagerの実装

- [ ] `PromptManager` クラス実装
- [ ] `.txt`ファイル読み込み機能
- [ ] プロンプトフォーマット機能（変数置換）
- [ ] エラーハンドリング（ファイルが存在しない場合）
- **完了条件**: プロンプトファイルを読み込んでフォーマットできる
- **依存**: Task 0.2
- **推定時間**: 1.5時間

#### Task 1.5: ロギング設定の実装

- [ ] ロギング設定関数実装（`setup_logging()`）
- [ ] 操作ログ設定（RotatingFileHandler）
- [ ] エラーログ設定
- [ ] アクセスログ設定
- [ ] FastAPIミドルウェアでアクセスログ記録
- **完了条件**: ログファイルが生成され、ログが記録される
- **依存**: Task 0.2
- **推定時間**: 2時間

#### Task 1.6: FileManagerの実装

- [ ] `FileManager` クラス実装
- [ ] PDF保存機能（UUIDでリネーム）
- [ ] PDF削除機能
- [ ] サムネイル生成機能（PyMuPDF + Pillow）
- [ ] ファイルパス取得機能
- [ ] ディスク容量チェック機能
- **完了条件**: PDFの保存・削除・サムネイル生成ができる
- **依存**: Task 0.2
- **推定時間**: 3時間

---

### Phase 2: AI統合（推定: 3-4日）

#### Task 2.1: Claude API Clientの実装

- [ ] AWS Bedrock Runtime boto3クライアント初期化
- [ ] `invoke_model` API呼び出し実装
- [ ] リトライロジック実装（tenacity、指数バックオフ）
- [ ] レート制限エラーハンドリング
- [ ] タイムアウト設定
- **完了条件**: Claude APIを呼び出し、レスポンスを受け取れる
- **依存**: Task 1.3
- **推定時間**: 3時間

#### Task 2.2: PDF→画像変換機能の実装

- [ ] PyMuPDFでPDFを画像に変換
- [ ] 複数ページPDF対応（全ページを個別画像に変換）
- [ ] 解像度調整（300dpi）
- [ ] PNG形式で出力
- [ ] 画像サイズ制限チェック（5MB以下）
- [ ] 圧縮機能（必要に応じて）
- **完了条件**: PDFを高品質な画像に変換できる
- **依存**: Task 1.6
- **推定時間**: 2時間

#### Task 2.3: プロンプトファイルの作成

- [ ] `extraction.txt` 作成（図枠情報抽出用）
- [ ] `classification.txt` 作成（図面分類用）
- [ ] `balloon_extraction.txt` 作成（風船抽出用）
- [ ] `similarity_search.txt` 作成（類似検索用）
- [ ] `natural_language_query.txt` 作成（自然言語クエリ解析用）
- [ ] 各プロンプトにFew-shot examples追加
- [ ] A3/A4サイズ、図枠右下、風船表記の情報を反映
- **完了条件**: 全プロンプトファイルが作成され、テスト実行できる
- **依存**: Task 1.4
- **推定時間**: 4時間

#### Task 2.4: AIAnalysisServiceの実装（図枠抽出）

- [ ] `AIAnalysisService` クラス実装
- [ ] `analyze_drawing()` メソッド実装
- [ ] 図枠情報抽出ロジック
- [ ] Claude APIレスポンスのパース（JSON）
- [ ] 信頼度スコア抽出
- [ ] 座標情報抽出
- [ ] エラーハンドリング（`AIAnalysisException`）
- **完了条件**: 図枠情報が抽出され、信頼度付きで返される
- **依存**: Task 2.1, Task 2.3
- **推定時間**: 4時間

#### Task 2.5: AIAnalysisServiceの実装（分類）

- [ ] `classify_drawing()` メソッド実装
- [ ] 部品図/ユニット図/組図の分類ロジック
- [ ] 分類理由の取得
- [ ] 信頼度スコア取得
- **完了条件**: 図面が正しく分類される
- **依存**: Task 2.4
- **推定時間**: 2時間

#### Task 2.6: AIAnalysisServiceの実装（風船抽出）

- [ ] `extract_balloons()` メソッド実装
- [ ] 風船番号、部品名、数量の抽出
- [ ] 風船の座標取得
- [ ] 信頼度スコア取得
- **完了条件**: 風船情報が抽出される
- **依存**: Task 2.4
- **推定時間**: 3時間

#### Task 2.7: AIAnalysisServiceの実装（改訂履歴）

- [ ] 改訂履歴抽出ロジック実装
- [ ] 表形式・非表形式の両方に対応
- [ ] 改訂番号、日付、内容、改訂者の抽出
- [ ] 信頼度スコア取得
- **完了条件**: 改訂履歴が抽出される
- **依存**: Task 2.4
- **推定時間**: 2時間

#### Task 2.8: AIAnalysisServiceの実装（要約・特徴抽出）

- [ ] 図面要約生成機能実装
- [ ] プレート図の形状特徴抽出（サイズ、穴の数、パターン）
- [ ] 類似検索用のメタデータ生成
- **完了条件**: 図面の要約とShape_featuresが生成される
- **依存**: Task 2.4
- **推定時間**: 2時間

---

### Phase 3: バックエンドサービス層（推定: 3-4日）

#### Task 3.1: DrawingServiceの実装（アップロード）

- [ ] `DrawingService` クラス実装
- [ ] `create_drawing()` メソッド実装
- [ ] 複数ページPDF対応（各ページを個別Drawing登録）
- [ ] PDF保存（FileManager使用）
- [ ] サムネイル生成
- [ ] AI解析のバックグラウンドタスク起動
- [ ] DB保存
- [ ] ユーザーID取得（`socket.gethostname()`）
- **完了条件**: PDFアップロード後、解析が開始される
- **依存**: Task 1.6, Task 2.4
- **推定時間**: 4時間

#### Task 3.2: DrawingServiceの実装（CRUD）

- [ ] `get_drawing()` メソッド実装
- [ ] `list_drawings()` メソッド実装（ページネーション、フィルタ）
- [ ] `update_drawing()` メソッド実装
- [ ] `delete_drawings()` メソッド実装（一括削除対応）
- [ ] 編集履歴の記録機能
- **完了条件**: 図面のCRUD操作ができる
- **依存**: Task 1.1
- **推定時間**: 3時間

#### Task 3.3: DrawingServiceの実装（承認機能）

- [ ] `approve_drawing()` メソッド実装
- [ ] `unapprove_drawing()` メソッド実装
- [ ] ステータス更新（`approved`, `unapproved`）
- [ ] 承認日時記録
- [ ] 操作ログ記録
- **完了条件**: 図面の承認・承認取り消しができる
- **依存**: Task 3.2
- **推定時間**: 2時間

#### Task 3.4: DrawingServiceの実装（一括操作）

- [ ] `bulk_update_tags()` メソッド実装
- [ ] `bulk_update_category()` メソッド実装
- [ ] `bulk_download()` メソッド実装（ZIP生成）
- [ ] トランザクション処理
- **完了条件**: 一括操作ができる
- **依存**: Task 3.2
- **推定時間**: 3時間

#### Task 3.5: LockManagerの実装

- [ ] `LockManager` クラス実装
- [ ] `acquire_lock()` メソッド実装
- [ ] `release_lock()` メソッド実装
- [ ] `check_lock()` メソッド実装
- [ ] `cleanup_expired_locks()` メソッド実装（バックグラウンドタスク）
- [ ] タイムアウト設定（5分）
- [ ] WebSocket通知連携
- **完了条件**: 編集ロックが正常に動作する
- **依存**: Task 1.1
- **推定時間**: 4時間

#### Task 3.6: SearchServiceの実装（自然言語検索）

- [ ] `SearchService` クラス実装
- [ ] `natural_language_search()` メソッド実装
- [ ] Claude APIでクエリ解析
- [ ] 構造化クエリに変換
- [ ] SQLクエリ生成・実行
- [ ] AND/OR条件対応
- **完了条件**: 自然言語で検索できる
- **依存**: Task 2.4
- **推定時間**: 4時間

#### Task 3.7: SearchServiceの実装（類似検索）

- [ ] `similarity_search()` メソッド実装
- [ ] Claude APIで画像比較
- [ ] 類似度スコア算出
- [ ] 類似度順にソート
- [ ] プレート図の形状特徴を活用
- **完了条件**: 類似図面を検索できる
- **依存**: Task 2.8
- **推定時間**: 4時間

---

### Phase 4: バックエンドAPI層（推定: 2-3日）

#### Task 4.1: FastAPIアプリケーション初期設定

- [ ] `main.py` 作成
- [ ] FastAPIインスタンス作成
- [ ] CORS設定
- [ ] ミドルウェア設定（ロギング）
- [ ] エラーハンドラー設定（`AIAnalysisException`, `LockException`）
- [ ] 起動確認
- **完了条件**: FastAPIが起動し、`/docs`でSwagger UIが表示される
- **依存**: Task 0.2
- **推定時間**: 1.5時間

#### Task 4.2: 図面管理APIの実装

- [ ] `POST /api/drawings/upload` 実装
- [ ] `GET /api/drawings` 実装（ページネーション、フィルタ）
- [ ] `GET /api/drawings/{drawing_id}` 実装
- [ ] `PUT /api/drawings/{drawing_id}` 実装
- [ ] `PUT /api/drawings/{drawing_id}/approve` 実装
- [ ] `PUT /api/drawings/{drawing_id}/unapprove` 実装
- [ ] `DELETE /api/drawings` 実装（一括削除）
- [ ] `POST /api/drawings/{drawing_id}/reanalyze` 実装
- [ ] バリデーション（Pydantic）
- **完了条件**: 全エンドポイントが正常に動作する
- **依存**: Task 3.1, Task 3.2, Task 3.3
- **推定時間**: 4時間

#### Task 4.3: 一括操作APIの実装

- [ ] `POST /api/drawings/bulk/tags` 実装
- [ ] `POST /api/drawings/bulk/category` 実装
- [ ] `POST /api/drawings/download/bulk` 実装（ZIP生成）
- [ ] `GET /api/drawings/{drawing_id}/download` 実装
- **完了条件**: 一括操作APIが動作する
- **依存**: Task 3.4
- **推定時間**: 2時間

#### Task 4.4: 検索APIの実装

- [ ] `POST /api/search/natural` 実装
- [ ] `POST /api/search/similar` 実装
- [ ] レスポンス形式の統一
- **完了条件**: 検索APIが動作する
- **依存**: Task 3.6, Task 3.7
- **推定時間**: 2時間

#### Task 4.5: ロック管理APIの実装

- [ ] `POST /api/locks/acquire` 実装
- [ ] `DELETE /api/locks/release` 実装
- [ ] `GET /api/locks/{drawing_id}` 実装
- **完了条件**: ロックAPIが動作する
- **依存**: Task 3.5
- **推定時間**: 1.5時間

#### Task 4.6: 設定APIの実装

- [ ] `GET /api/config/extraction-fields` 実装
- [ ] config.jsonから設定値を返す
- **完了条件**: 設定APIが動作する
- **依存**: Task 1.3
- **推定時間**: 30分

#### Task 4.7: WebSocket実装

- [ ] WebSocketエンドポイント実装
- [ ] `subscribe_drawing` イベント実装
- [ ] `unsubscribe_drawing` イベント実装
- [ ] `drawing_locked` イベント実装
- [ ] `drawing_unlocked` イベント実装
- [ ] LockManagerとの連携
- **完了条件**: WebSocketでリアルタイム通知ができる
- **依存**: Task 3.5
- **推定時間**: 3時間

---

### Phase 5: フロントエンド基礎実装（推定: 3-4日）

#### Task 5.1: ルーティング設定

- [ ] React Router設定
- [ ] ルート定義（`/upload`, `/search`, `/similar-search`, `/list`, `/edit/:id`）
- [ ] 404ページ実装
- **完了条件**: ページ遷移ができる
- **依存**: Task 0.3
- **推定時間**: 1時間

#### Task 5.2: API Clientの実装

- [ ] Axiosインスタンス作成
- [ ] エラーハンドリング設定（インターセプター）
- [ ] 型定義（TypeScript interface）
- [ ] API関数実装（`uploadDrawing`, `getDrawings`, `updateDrawing`, etc.）
- **完了条件**: バックエンドAPIを呼び出せる
- **依存**: Task 4.1
- **推定時間**: 2時間

#### Task 5.3: 状態管理（Zustand）の実装

- [ ] `drawingStore` 実装
- [ ] `searchStore` 実装
- [ ] `uiStore` 実装（ローディング、トースト通知）
- [ ] WebSocket統合
- **完了条件**: グローバル状態が管理できる
- **依存**: Task 5.2
- **推定時間**: 2時間

#### Task 5.4: 共通UIコンポーネントの実装

- [ ] Layoutコンポーネント（ヘッダー、ナビゲーション）
- [ ] Toastコンポーネント（react-hot-toast）
- [ ] Modalコンポーネント（shadcn/ui Dialog）
- [ ] Loaderコンポーネント
- [ ] Buttonコンポーネント（青アクセント）
- [ ] shadcn/ui のカスタマイズ（白/青テーマ）
- **完了条件**: 共通コンポーネントが再利用できる
- **依存**: Task 0.3
- **推定時間**: 3時間

---

### Phase 6: フロントエンドメイン機能（推定: 4-5日）

#### Task 6.1: アップロード画面の実装

- [ ] UploadViewコンポーネント実装
- [ ] ドラッグ&ドロップエリア実装
- [ ] ファイル選択ボタン
- [ ] アップロード進捗表示
- [ ] 最近アップロードした図面表示（カード形式）
- [ ] バリデーション（PDFのみ、50MB以下）
- **完了条件**: PDFをアップロードできる
- **依存**: Task 5.2, Task 5.4
- **推定時間**: 4時間

#### Task 6.2: PDFViewerコンポーネントの実装

- [ ] PDF.js統合
- [ ] PDF表示機能
- [ ] ズーム機能（+/-ボタン）
- [ ] 回転機能
- [ ] ページめくり機能
- [ ] Fit to width デフォルト設定
- [ ] PDF.js Worker設定
- **完了条件**: PDFが表示され、操作できる
- **依存**: Task 0.3
- **推定時間**: 4時間

#### Task 6.3: PDFViewerのハイライト機能実装

- [ ] Canvas レイヤー実装
- [ ] ハイライト描画機能
- [ ] 座標からハイライト表示
- [ ] ハイライトクリック時のズーム機能
- [ ] 枠線・色の設定
- **完了条件**: フィールドクリック時に該当箇所がハイライトされる
- **依存**: Task 6.2
- **推定時間**: 3時間

#### Task 6.4: EditFormコンポーネントの実装

- [ ] EditFormコンポーネント実装
- [ ] 基本情報セクション（図番、タイトル、作成日など）
- [ ] 各フィールドに信頼度％表示
- [ ] 70%未満のフィールドにインライン警告
- [ ] React Hook Form統合
- [ ] バリデーション（Zod）
- **完了条件**: 解析結果を編集できる
- **依存**: Task 5.4
- **推定時間**: 4時間

#### Task 6.5: EditFormのタグ・分類セクション実装

- [ ] タグ入力コンポーネント実装（追加・削除）
- [ ] 分類ドロップダウン実装
- [ ] タグのオートコンプリート（オプション）
- **完了条件**: タグと分類を編集できる
- **依存**: Task 6.4
- **推定時間**: 2時間

#### Task 6.6: EditFormの改訂履歴・風船情報セクション実装

- [ ] 改訂履歴テーブル実装
- [ ] 風船情報テーブル実装
- [ ] 風船クリック時のハイライト連携
- [ ] 改訂履歴・風船情報の編集機能
- **完了条件**: 改訂履歴と風船情報を表示・編集できる
- **依存**: Task 6.4
- **推定時間**: 3時間

#### Task 6.7: EditFormの編集履歴セクション実装

- [ ] 編集履歴パネル実装（展開/折りたたみ）
- [ ] 編集履歴の表示（誰が・いつ・何を）
- [ ] 変更前後の値表示
- **完了条件**: 編集履歴が表示される
- **依存**: Task 6.4
- **推定時間**: 2時間

#### Task 6.8: 図面編集画面（DrawingEditorView）の実装

- [ ] DrawingEditorViewコンポーネント実装
- [ ] 2分割レイアウト（左30%、右70%）
- [ ] レスポンシブ対応（モバイル/タブレットで縦並び）
- [ ] EditFormとPDFViewerの統合
- [ ] フィールドクリック時のハイライト連携
- [ ] 複数図面の順次処理（進捗表示、前へ/次へボタン）
- [ ] 承認・保存ボタン
- [ ] 編集ロック状態の表示
- **完了条件**: 図面編集画面が完全に機能する
- **依存**: Task 6.2, Task 6.3, Task 6.4, Task 6.6, Task 6.7
- **推定時間**: 5時間

#### Task 6.9: 一覧画面（ListView）の実装

- [ ] ListViewコンポーネント実装
- [ ] カード表示実装（デフォルト）
- [ ] テーブル表示実装
- [ ] 表示切り替えボタン
- [ ] ソート機能（新しい順がデフォルト）
- [ ] フィルタ機能
- [ ] ページネーション
- [ ] 複数選択（チェックボックス）
- [ ] 一括操作ボタン（タグ付け、削除、ダウンロード）
- [ ] react-windowで仮想化（オプション）
- **完了条件**: 図面一覧が表示され、操作できる
- **依存**: Task 5.2, Task 5.4
- **推定時間**: 5時間

#### Task 6.10: 検索画面（SearchView）の実装

- [ ] SearchViewコンポーネント実装
- [ ] タブ切り替え（自然言語検索/類似検索）
- [ ] 自然言語検索フォーム
- [ ] 検索例の表示
- [ ] 結果表示（テーブル/カード切り替え）
- [ ] チェックボックスで複数選択
- [ ] ダウンロードボタン
- **完了条件**: 自然言語検索ができる
- **依存**: Task 5.2, Task 6.9
- **推定時間**: 4時間

#### Task 6.11: 類似検索機能の実装

- [ ] 類似検索タブの実装
- [ ] 「類似図面を検索」ボタン（図面編集画面）
- [ ] 類似度スコア表示
- [ ] 検索元図面と並べて表示
- **完了条件**: 類似図面を検索できる
- **依存**: Task 6.10
- **推定時間**: 3時間

---

### Phase 7: 編集ロック・WebSocket連携（推定: 1-2日）

#### Task 7.1: WebSocketクライアントの実装

- [ ] Socket.IO Clientセットアップ
- [ ] `subscribe_drawing` イベント送信
- [ ] `drawing_locked` イベント受信
- [ ] `drawing_unlocked` イベント受信
- [ ] Zustand storeとの連携
- **完了条件**: WebSocketでリアルタイム通知が受信できる
- **依存**: Task 5.3
- **推定時間**: 2時間

#### Task 7.2: 編集ロック機能の統合

- [ ] 図面編集画面でロック取得
- [ ] 他のユーザーがロック中の場合、読み取り専用表示
- [ ] ロック中の通知（トースト）
- [ ] 画面を閉じた時にロック解放
- [ ] タイムアウト後の自動解放
- **完了条件**: 編集ロックが正常に機能する
- **依存**: Task 7.1, Task 6.8
- **推定時間**: 3時間

---

### Phase 8: テスト・デバッグ（推定: 2-3日）

#### Task 8.1: バックエンド単体テストの作成

- [ ] AIAnalysisServiceのテスト
- [ ] DrawingServiceのテスト
- [ ] LockManagerのテスト
- [ ] SearchServiceのテスト
- [ ] pytest実行確認
- **完了条件**: カバレッジ70%以上
- **依存**: Phase 3
- **推定時間**: 4時間

#### Task 8.2: フロントエンド単体テストの作成

- [ ] PDFViewerのテスト
- [ ] EditFormのテスト
- [ ] API Clientのテスト（モック）
- [ ] Vitest実行確認
- **完了条件**: 主要コンポーネントがテストされている
- **依存**: Phase 6
- **推定時間**: 3時間

#### Task 8.3: 統合テストの実施

- [ ] 図面アップロード→解析→編集→承認のフロー確認
- [ ] 複数ページPDFのテスト
- [ ] 編集ロックのテスト（2ユーザー）
- [ ] 一括操作のテスト
- [ ] エラーハンドリングのテスト（API失敗、リトライ）
- **完了条件**: 全フローが正常に動作する
- **依存**: Phase 7
- **推定時間**: 4時間

#### Task 8.4: E2Eテストの実施（オプション）

- [ ] Playwrightセットアップ
- [ ] アップロード→編集→承認のE2Eテスト
- [ ] 検索機能のE2Eテスト
- **完了条件**: E2Eテストが通る
- **依存**: Task 8.3
- **推定時間**: 3時間

---

### Phase 9: 最終調整・ドキュメント（推定: 1-2日）

#### Task 9.1: エラーメッセージの日本語化

- [ ] 全エラーメッセージを日本語に統一
- [ ] ユーザーフレンドリーなメッセージに修正
- [ ] 信頼度警告メッセージの調整
- **完了条件**: エラーメッセージが分かりやすい
- **依存**: Phase 8
- **推定時間**: 2時間

#### Task 9.2: UI/UXの最終調整

- [ ] 青/白テーマの微調整
- [ ] ボタン配置の最適化
- [ ] レスポンシブデザインの確認
- [ ] アクセシビリティ確認
- **完了条件**: UIが洗練されている
- **依存**: Phase 6
- **推定時間**: 3時間

#### Task 9.3: パフォーマンス最適化

- [ ] 画像読み込みの最適化
- [ ] バックグラウンドタスクの最適化
- [ ] DBクエリの最適化（N+1問題）
- [ ] フロントエンドコード分割
- **完了条件**: パフォーマンスが十分
- **依存**: Phase 8
- **推定時間**: 3時間

#### Task 9.4: README・ドキュメントの作成

- [ ] README.md 完成（セットアップ手順、使用方法）
- [ ] AWS Bedrock設定ガイド
- [ ] config.jsonの設定例
- [ ] トラブルシューティング
- [ ] API ドキュメント（OpenAPI）
- **完了条件**: ドキュメントが完備されている
- **依存**: すべて
- **推定時間**: 3時間

#### Task 9.5: 受け入れテスト

- [ ] テストケース1-10を実施（requirements.mdの成功基準）
- [ ] バグ修正
- [ ] 最終動作確認
- **完了条件**: 全受け入れテストが通る
- **依存**: Task 9.1, Task 9.2, Task 9.3
- **推定時間**: 4時間

---

## 実装順序

### 推奨実装順序

1. **Phase 0** → **Phase 1** → **Phase 2** → **Phase 3** → **Phase 4**（バックエンド完成）
2. **Phase 5** → **Phase 6**（フロントエンド基礎）
3. **Phase 7**（WebSocket連携）
4. **Phase 8**（テスト）
5. **Phase 9**（最終調整）

### 並行実行可能なタスク

- **Phase 2**（AI統合）と **Phase 5**（フロントエンド基礎）は並行実行可能
- **Task 6.2-6.7**（フロントエンドコンポーネント）は一部並行実行可能

### クリティカルパス

```
Task 0.1 → Task 0.2 → Task 1.1 → Task 1.3 → Task 2.1 → Task 2.3 → Task 2.4
→ Task 3.1 → Task 4.1 → Task 4.2 → Task 5.2 → Task 6.8 → Task 7.2 → Task 8.3
```

---

## リスクと対策

| リスク | 対策 |
|--------|------|
| **Claude API解析精度が低い** | プロンプトの段階的改善、Few-shot examples追加、信頼度70%未満フィールドの手動編集 |
| **複数ページPDF処理が遅い** | バックグラウンドタスクで非同期処理、進捗表示 |
| **編集ロックの競合が複雑** | シンプルな先着ロック方式、WebSocketでリアルタイム通知 |
| **PDF.jsのハイライトが困難** | Canvas APIを使用、座標情報を正確に取得 |
| **開発期間が予定を超過** | MVPに集中、オプション機能は後回し |

---

## 注意事項

### 実装時の注意点

1. **コミット単位**: 各タスクを1-2コミットで完結させる
2. **テスト駆動**: 重要な機能（AI解析、ロック機能）は先にテストを書く
3. **ログ記録**: 操作ログ・エラーログを適切に記録する
4. **型安全性**: TypeScript/Pythonの型チェックを活用
5. **エラーハンドリング**: ユーザーフレンドリーなエラーメッセージ

### レビューポイント

- [ ] 信頼度70%未満のフィールドに警告が表示されるか
- [ ] 複数ページPDFが個別図面として登録されるか
- [ ] 編集ロックが正常に機能するか
- [ ] プロンプトが`.txt`ファイルで管理されているか
- [ ] ログが正しく記録されているか

---

## 実装開始ガイド

### 開始手順

1. **Phase 0のタスクから順次実行**してください
2. 各タスクの開始時に**TodoWriteツール**で`in_progress`に更新
3. 完了時は`completed`に更新
4. 問題発生時は速やかに報告してください

### 初日の推奨タスク

1. Task 0.1: プロジェクト構造の作成
2. Task 0.2: バックエンド依存関係のセットアップ
3. Task 0.3: フロントエンド依存関係のセットアップ
4. Task 0.4: 環境変数と設定ファイルの準備
5. Task 1.1: データベースモデルの実装

### 実装時のコツ

- **AI解析**: プロンプトは段階的に改善。最初は簡単な例でテスト。
- **UI実装**: モックデータで先に画面を作り、後からAPI連携
- **デバッグ**: ログを活用。特にClaude APIのレスポンスを記録

---

**作成日**: 2025-11-14
**作成者**: Claude Code
**バージョン**: 1.0
